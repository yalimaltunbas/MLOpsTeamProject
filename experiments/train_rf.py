# -*- coding: utf-8 -*-
"""train_rf.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1O6f4_itXAbqxabxvCfeXI5VYgb4cfOei
"""

from google.colab import files
uploaded = files.upload()

import pandas as pd

df = pd.read_csv("synthetic_medical_data.csv")  # datamÄ±z
df.head()

#Veri Temizleme PlanÄ±
from sklearn.model_selection import train_test_split
import pandas as pd

# 1ï¸âƒ£ SayÄ±sal sÃ¼tunlarÄ± median ile doldur
num_cols = df.select_dtypes(exclude='object').columns
df[num_cols] = df[num_cols].fillna(df[num_cols].median())

# 2ï¸âƒ£ Kategorik sÃ¼tunlarÄ± "Missing" ile doldur
cat_cols = df.select_dtypes(include='object').columns
df[cat_cols] = df[cat_cols].fillna("Missing")

# 3ï¸âƒ£ One-hot encoding (kategorik deÄŸiÅŸkenleri sayÄ±ya Ã§evir)
df_encoded = pd.get_dummies(df, drop_first=True)

# 4ï¸âƒ£ BaÄŸÄ±msÄ±z deÄŸiÅŸkenler (X) ve hedef (y)
X = df_encoded.drop("Dead", axis=1)
y = df_encoded["Dead"]

# 5ï¸âƒ£ Veriyi ayÄ±r
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42, stratify=y)

print("âœ… Train:", X_train.shape, " Test:", X_test.shape)
print("Ã–rnek sÄ±nÄ±f oranÄ±:", y.value_counts(normalize=True).round(3))

#2- RandomForest
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import classification_report, confusion_matrix, roc_auc_score

# Modeli tanÄ±mla
rf = RandomForestClassifier(
    n_estimators=300,
    max_depth=None,
    class_weight='balanced',
    random_state=42
)

# EÄŸit
rf.fit(X_train, y_train)

# Testte tahmin yap
y_pred = rf.predict(X_test)
y_proba = rf.predict_proba(X_test)[:, 1]

# DeÄŸerlendirme
print("ğŸ”¹ ROC-AUC:", round(roc_auc_score(y_test, y_proba), 3))
print("\nğŸ”¹ SÄ±nÄ±flandÄ±rma Raporu:\n", classification_report(y_test, y_pred))
print("\nğŸ”¹ Confusion Matrix:\n", confusion_matrix(y_test, y_pred))

#RandomForest iÃ§in SMOTE(az olan sÄ±nÄ±f iÃ§in sentetik veri Ã¼retimi) uygulandÄ±.
from imblearn.over_sampling import SMOTE
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import classification_report, confusion_matrix, roc_auc_score

# 1ï¸âƒ£ Oversampling
smote = SMOTE(random_state=42)
X_res, y_res = smote.fit_resample(X_train, y_train)

print("Yeni sÄ±nÄ±f oranÄ±:")
print(y_res.value_counts(normalize=True).round(3))

# 2ï¸âƒ£ Model
rf_smote = RandomForestClassifier(
    n_estimators=300,
    random_state=42
)
rf_smote.fit(X_res, y_res)

# 3ï¸âƒ£ Test performansÄ±
y_pred = rf_smote.predict(X_test)
y_proba = rf_smote.predict_proba(X_test)[:, 1]

print("ğŸ”¹ ROC-AUC:", round(roc_auc_score(y_test, y_proba), 3))
print("\nğŸ”¹ SÄ±nÄ±flandÄ±rma Raporu:\n", classification_report(y_test, y_pred))
print("\nğŸ”¹ Confusion Matrix:\n", confusion_matrix(y_test, y_pred))

